@startuml reconciliation_schema

!define LIGHTBLUE #E1F5FE
!define LIGHTGREEN #E8F5E8
!define LIGHTYELLOW #FFF9C4
!define LIGHTPINK #FCE4EC

title Rapprochement bancaire

class ReleveParser LIGHTBLUE {
    +parse() : ParserResult
}

class ParserResult LIGHTYELLOW {
    ' Structure contenant les éléments identifiés
    ' dans le relevé de compte
}

class Reconciliator LIGHTGREEN {
    -parserResult : ParserResult
    -statementOperations : StatementOperation[]
    --
    +Reconciliator(parserResult : ParserResult)
    +to_HTML() : String
    +getResults() : ReconciliationResult
}

class StatementOperation LIGHTPINK {
    -date : Date
    -montant : Float
    -nature : String
    -reconciliationLines : ReconciliationLine[]
    -proposalLine : ProposalLine
    -multiProposalCombinations : MultiProposalCombination[]
    --
    +to_HTML() : String
}

class ReconciliationLine LIGHTBLUE {
    -montant : Float
    -gvvEntry : Object
    --
    +to_HTML() : String
}

class ProposalLine LIGHTYELLOW {
    ' Contient les informations sur les
    ' propositions de rapprochements
    --
    +to_HTML() : String
}

class MultiProposalCombination LIGHTGREEN {
    ' Combinaison d'écritures dont le montant
    ' additionné correspond à la somme d'un
    ' élément de relevé (StatementOperation)
    --
    +to_HTML() : String
}

' Relations
ReleveParser --> ParserResult : "produit"
Reconciliator --> ParserResult : "utilise"
Reconciliator "1" *-- "*" StatementOperation : "contient"
StatementOperation "1" *-- "*" ReconciliationLine : "peut contenir"
StatementOperation "1" o-- "0..1" ProposalLine : "peut contenir"
StatementOperation "1" o-- "*" MultiProposalCombination : "peut contenir"

' Notes explicatives
note right of ReleveParser : Parse le relevé de compte\net retourne un ParserResult
note right of Reconciliator : Fait le rapprochement avec\nles écritures GVV en base
note right of StatementOperation : Résultat du rapprochement\nd'une opération du relevé
note right of ReconciliationLine : Rapprochement d'un montant.\nUne ou plusieurs par StatementOperation
note bottom of ProposalLine : Contient les informations\nsur les propositions de rapprochements
note bottom of MultiProposalCombination : Combinaison d'écritures dont\nle montant additionné correspond\nau montant d'une StatementOperation

@enduml
